<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Providers</title>
</head><body>WMI Providers <br/>
Providers are the backbone of WMI. Nearly all WMI classes and their respective methods are implemented in providers. A provider is a user-mode COM DLL or kernel driver. Each provider has a respective CLSID associated with it used for COM resolution in the registry. This CLSID is used to look up the actual DLL that implements the provider. Additionally, all registered providers have a respective __Win32Provider WMI class instance. For example, consider the following registered WMI provider that handles registry actions: <br/>
<br/>
PS C:\&gt; Get-CimInstance -Namespace root\cimv2 -ClassName __Win32Provider -Filter ‘Name =<br/>
“RegistryEventProvider”’<br/>
Name : RegistryEventProvider<br/>
ClientLoadableCLSID :<br/>
CLSID : {fa77a74e-e109-11d0-ad6e-00c04fd8fdff}<br/>
Concurrency :<br/>
DefaultMachineName :<br/>
Enabled :<br/>
HostingModel : LocalSystemHost<br/>
ImpersonationLevel : 0<br/>
InitializationReentrancy : 0<br/>
InitializationTimeoutInterval :<br/>
InitializeAsAdminFirst :<br/>
OperationTimeoutInterval :<br/>
PerLocaleInitialization : False<br/>
PerUserInitialization : False<br/>
Pure : True<br/>
SecurityDescriptor :<br/>
SupportsExplicitShutdown :<br/>
SupportsExtendedStatus :<br/>
SupportsQuotas :<br/>
SupportsSendStatus :<br/>
SupportsShutdown :<br/>
SupportsThrottling :<br/>
UnloadTimeout :<br/>
Version :<br/>
PSComputerName :<br/>
<br/>
The DLL that corresponds to the RegistryEventProvider provider is found by referencing the following registry value: <br/>
HKEY_CLASSES_ROOT\CLSID\{fa77a74e-e109-11d0-ad6e00c04fd8fdff}\InprocServer32 : (Default) <br/>
<br/>
<br/>
Malicious WMI Providers <br/>
Just as a WMI provider is used to provide legitimate WMI functionality to a user, a malicious WMI provider can be used to extend the functionality of WMI for an attacker. <br/>
<br/>
Casey Smith and Jared Atkinson have both released proof-of-concept malicious WMI providers capable of executing shellcode and PowerShell scripts remotely. A malicious WMI provider serves as an effective persistence mechanism allowing an attacker to execute code remotely so long the attacker is in possession of valid user credentials. <br/>
<br/>
<br/>
</body></html>